(self.webpackJsonp__wix_thunderbolt_app=self.webpackJsonp__wix_thunderbolt_app||[]).push([[5776],{99936:function(e,t,n){"use strict";n.d(t,{E:function(){return r}});var r=function(){function e(){}return e.verify=function(t){if(t instanceof e)return t;throw new Error("This class must extend BaseStorage!")},e.prototype.extendScope=function(e){return e},e}()},28660:function(e,t,n){"use strict";n.d(t,{N:function(){return P}});var r=n(31191),o=n(99936),a={NOT_FOUND:new Error("Key was not found in capsule"),SERVER_ERROR:new Error("Failed to perform operarion on server"),LOCAL_STORAGE_UNSUPPORTED:new Error("LocalStorage is not supported"),COOKIE_CONSENT_DISALLOWED:new Error("The item cannot be set because the user has not approved the category it belongs to")};var i="capsule",s=a.NOT_FOUND,c=a.LOCAL_STORAGE_UNSUPPORTED,u=a.COOKIE_CONSENT_DISALLOWED,l=["essential","functional","analytics","advertising"];function p(e){!function(e){if(!e)return;if(-1===l.indexOf(e)){var t=l.map((function(e){return"'"+e+"'"})).join(", ");throw new Error("category must be one of "+t)}}(e);var t=("object"==typeof consentPolicyManager&&consentPolicyManager.getCurrentConsentPolicy&&consentPolicyManager.getCurrentConsentPolicy()||"object"==typeof Wix&&Wix.Utils&&Wix.Utils.getCurrentConsentPolicy&&Wix.Utils.getCurrentConsentPolicy()||{}).policy;if(void 0!==t&&!t[e])throw u}function d(e){var t=e.split("#"),n=t[0],r=t[1],o=n.split("|"),a=o[1],i=o[2];return void 0===i?{namespace:a,key:r}:{namespace:a,scope:i,key:r}}function f(e){return JSON.parse(e)}function g(e){void 0===e&&(e=i+"|");for(var t=[],n=0;n<localStorage.length;n++){var o=localStorage.key(n);if(o.startsWith(e)){var a=localStorage.getItem(o);t.push((0,r.pi)((0,r.pi)({size:o.length+a.length,originalKey:o},f(a)),d(o)))}}return t}function m(e){return!!e.expiration&&e.createdAt+1e3*e.expiration<=Date.now()}function v(e,t){return void 0===t&&(t=e.records[0]),localStorage.removeItem(t.originalKey),{records:t===e.records[0]?e.records.slice(1):e.records.filter((function(e){return e.originalKey!==t.originalKey})),requiredSpace:e.requiredSpace-t.size}}function y(e,t){return e.lastUsed-t.lastUsed}function I(e){return e.records.length>0&&e.requiredSpace>0}function h(e){var t={records:g(),requiredSpace:e};!function(e){for(e.records.sort(y);I(e);)e=v(e)}(t=function(e){return e.records.filter((function(e){return m(e)})).forEach((function(t){return e=v(e,t)})),e}(t))}var P=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t.prototype.setItem=function(e,t,n){return(0,r.mG)(this,void 0,void 0,(function(){var o,a;return(0,r.Jh)(this,(function(r){o=C(e,n),a=R(t,n),n.category&&p(n.category);try{localStorage.setItem(o,a)}catch(e){h(o.length+a.length),localStorage.setItem(o,a)}return[2]}))}))},t.prototype.getItem=function(e,t){var n,r=C(e,t);try{n=localStorage.getItem(r)}catch(e){return Promise.reject(c)}return(n=n&&f(n))&&!m(n)?(function(e,t){var n=t.expiration,r=t.createdAt;localStorage.setItem(e,R(t.value,{expiration:n,createdAt:r}))}(r,n),Promise.resolve(n.value)):Promise.reject(s)},t.prototype.removeItem=function(e,t){return e=C(e,t),localStorage.removeItem(e),Promise.resolve()},t.prototype.getAllItems=function(e){var t=S(e),n={};return g(t).forEach((function(e){m(e)||(n[e.key]=e.value)})),Promise.resolve(n)},t}(o.E);function C(e,t){return S(t)+e}function S(e){return[i,e.namespace,(t=e.scope,"string"==typeof t?t:JSON.stringify(t))].filter((function(e){return e})).join("|")+"#";var t}function R(e,t){var n={lastUsed:Date.now(),createdAt:t.createdAt||Date.now(),expiration:t.expiration,value:e};return JSON.stringify(n)}},1358:function(e){"use strict";e.exports=function(e,t,n){var r=e.split(t,n);if(r.length===n){var o=0;o="string"==typeof t?r.join(t).length:r.reduce((function(r,o,a){var i=0;return a+1<n&&(i=e.slice(r).match(t).shift().length),r+o.length+i}),0),r[n-1]+=e.slice(o)}return r}},3126:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.connectionRequestMsg="req_con",t.connectionSuccessMsg="connection_success",t.messageDelimiter="|",t.deafultConnectionMaxTimeout=200,t.deafultMessageMaxTimeout=5e3},91979:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.onmessage=function(n){var o=n.data,a=(0,r.parseChannelMessage)(o),i=a.id,s={data:a.payload,origin:n.origin,lastEventId:n.lastEventId,source:n.source,ports:n.ports};t(s,(function(t){e.postMessage((0,r.constructChannelMessage)(t,i))}))}};var r=n(69216)},6739:function(e,t,n){"use strict";var r,o=n(3126),a=n(69216),i=n(91979),s=(r=i)&&r.__esModule?r:{default:r};function c(e,t){try{return(0,a.parseConnectionMessage)(e)===t}catch(e){return!1}}function u(e){try{return e.ports[0]}catch(e){}}function l(e){e.postMessage(o.connectionSuccessMsg)}var p=function(){};e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p;if(!e||"string"!=typeof e)throw new Error("listener function expects to recieve a scope<string> as a first argument");var n=function(n){if(c(n.data,e)){var r=u(n);r&&(l(r),(0,s.default)(r,t))}};return window.addEventListener("message",n),function(){return window.removeEventListener("message",n)}}},69216:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseConnectionMessage=t.constructConnectionMessage=t.parseChannelMessage=t.constructChannelMessage=void 0;var r=n(3126);t.constructChannelMessage=function(e,t){return t?t+r.messageDelimiter+e:e},t.parseChannelMessage=function(e){var t=e.indexOf(r.messageDelimiter);return-1===t?{id:null,payload:e}:{id:e.slice(0,t),payload:e.slice(t+1)}},t.constructConnectionMessage=function(e){return r.connectionRequestMsg+r.messageDelimiter+e},t.parseConnectionMessage=function(e){var t=e.indexOf(r.messageDelimiter);if(-1===t||e.slice(0,t)!==r.connectionRequestMsg)throw new Error("Invalid connection message");return e.slice(t+1)}},93392:function(e,t,n){e.exports=n(6739)},77033:function(e,t,n){"use strict";n.r(t),n.d(t,{MasterPageTpaPropsCacheSymbol:function(){return o.lP},PinnedExternalIdStoreSymbol:function(){return o.Aq},TpaContextMappingSymbol:function(){return o.ex},TpaDataCapsuleSymbol:function(){return o.yA},TpaHandlersManagerSymbol:function(){return o.XA},TpaSectionSymbol:function(){return o.B_},TpaSrcBuilderSymbol:function(){return o.RN},TpaSrcUtilitySymbol:function(){return o.NQ},name:function(){return o.u2},site:function(){return k}});var r=n(46450),o=n(64318),a=n(56510),i=n(31619),s=n(25259),c=n(21980),u=n(54164),l=n(2922),p=n(55437),d=n(18037),f=n.n(d),g=n(71621),m=n(21085);const v=(0,a.ff)([(0,a.t6)(s.R9,o.u2)],(e=>({getQueryParams({compId:t,pageId:n,tpaCompData:r,options:{extraQueryParams:o}}){const{siteRevision:a,editorOrSite:i,deviceType:s,locale:c,tpaDebugParams:u,timeZone:l,regionalLanguage:p}=e,{templateId:d,width:g,height:m,isResponsive:v}=r;return Object.assign(Object.assign({pageId:n,compId:d||t,viewerCompId:t,siteRevision:`${a}`,viewMode:i,deviceType:s,locale:c,tz:l,regionalLanguage:p,width:!v&&f().isNumber(g)?`${g}`:null,height:!v&&f().isNumber(m)?`${m}`:null},u),o)}}))),y=(0,a.ff)([],(()=>({getQueryParams({tpaCompData:e}){const{externalId:t}=e;return{externalId:t}}}))),I=(0,a.ff)([(0,a.t6)(s.R9,o.u2),i.Xb],(({widgetsClientSpecMapData:e},t)=>({getQueryParams({tpaCompData:n,options:r}){const o=(e[n.widgetId]||{}).appDefinitionId||r.appDefinitionId||"";return{instance:t.getAppInstanceByAppDefId(o)}}}))),h=(0,a.ff)([(0,a.t6)(s.R9,o.u2),c.ZQ],((e,t)=>({getQueryParams(){var n;const{requestUrl:r,extras:o}=e,a=new URL((null===(n=null==t?void 0:t.location)||void 0===n?void 0:n.href)||r);return{currency:o.currency,currentCurrency:a.searchParams.get("currency")||o.currency}}}))),P=(0,a.ff)([u.s],(({viewerSessionId:e})=>({getQueryParams:()=>({vsi:e})}))),C=(0,a.ff)([g.e],(e=>({getQueryParams(){const t=e.getCurrentConsentPolicy();var n;return{"consent-policy":(n=t).defaultPolicy&&f().every(n.policy)||!e._getConsentPolicyHeader()["consent-policy"]?void 0:decodeURIComponent(e._getConsentPolicyHeader()["consent-policy"])}}}))),S=(0,a.ff)([m.p],(e=>({getQueryParams:()=>({commonConfig:JSON.stringify(e.getCommonConfigForUrl())})}))),R=(0,a.ff)([l.jj],(e=>({getQueryParams(){var t,n;const r=null===(n=null===(t=e.getCurrentRouteInfo())||void 0===t?void 0:t.dynamicRouteData)||void 0===n?void 0:n.publicData;return{routerData:r?JSON.stringify(r):null}}}))),w=(0,a.ff)([(0,a.t6)(s.R9,o.u2),p.QZ,c.ZQ],((e,t,n)=>({getQueryParams({compId:r,tpaCompData:o,options:a}){var i;const{widgetsClientSpecMapData:s,appSectionParams:c,isMobileView:u,requestUrl:l,viewMode:p,externalBaseUrl:d}=e,f={target:null,"section-url":null};if(o.widgetId){const{widgetUrl:e,mobileUrl:n}=s[o.widgetId],c=u&&n||e,l=((null===(i=t.get(r))||void 0===i?void 0:i.componentType)||"").toLowerCase().endsWith("section");o.isSection&&l&&("site"===p?(f["section-url"]=`${d}/${a.tpaInnerRouteConfig.tpaPageUri}/`,f.target="_top"):(f["section-url"]=c,f.target="_self"))}return Object.assign(Object.assign({},(()=>{var e;if(n){const t=new URL((null===(e=null==n?void 0:n.location)||void 0===e?void 0:e.href)||l).searchParams.get("appSectionParams");return JSON.parse(decodeURIComponent(t||"{}"))||{}}return c})()),f)}})));var x=n(1358),O=n.n(x),E=n(93392),D=n.n(E),M=n(99936),T=n(28660),b=function(){function e(e){void 0===e&&(e=new T.N),this.storageStrategy=M.E.verify(e)}return e.prototype.start=function(e,t){if(!e||"function"!=typeof e)throw new Error("start function must get a verifier function as a first argument");if(t&&"function"!=typeof t)throw new Error("the interceptor must be a function");var n=M.E.verify(this.storageStrategy);this.stopListener=D()("data-capsule",(function(r,o){if("string"!=typeof r.data)return;var a=O()(r.data,"|",3),i=a[0],s=a[1],c=a[2],u=function(e,t){if("resolve"===e){var n=[e,JSON.stringify({data:t})].join("|");return o(n)}var r=[e,t].join("|");return o(r)};if(!e(r.source,r.origin,i))return u("reject","message was not authorized");var l=n[s].bind(n),p=JSON.parse(c).data,d=p[p.length-1],f=t?t(d,r.source,r.origin,i):d;return p[p.length-1]=f,l.apply(void 0,p).then((function(e){return u("resolve",e)})).catch((function(e){return u("reject",e.message||e)}))}))},e.prototype.stop=function(){this.stopListener&&this.stopListener()},e}();const _=(0,a.ff)([(0,a.t6)(s.R9,o.u2)],(({metaSiteId:e})=>{const t={},n=(e,n,r)=>t[r],r=(n,r,o,a)=>(n.namespace=t[a],n.scope=e,n),o=f().once((async()=>{(new b).start(n,r)}));return{registerToDataCapsule(e,n){o(),t[e]=n},unregister(e){delete t[e]}}}));var U=n(13487);const j=(0,a.ff)([],(()=>{const e={},t={};return{registerTpasForContext({contextId:t,pageId:n},r){r.forEach((r=>{e[r]={contextId:t,pageId:n}}))},getTpaComponentPageInfo:t=>e[t],registerTpaTemplateId(e,n){t[e]=n},getTpaComponentIdFromTemplate:e=>t[e],unregisterTpa(t){delete e[t]}}}));var N=n(62824);const A=(0,a.ff)([(0,a.t6)(s.R9,o.u2),c.ZQ,(0,a.fi)(r.RR)],(({widgetsClientSpecMapData:e,externalBaseUrl:t,requestUrl:n},r,o)=>({buildSrc(a,i,s,c,u={}){const l=e[s.widgetId]||{},p=f().merge({tpaInnerRouteConfig:null,extraQueryParams:{},appDefinitionId:""},u),d={compId:a,pageId:i,tpaCompData:s,options:p},g=f().assign({},...o.map((e=>e.getQueryParams(d)))),m=p.tpaInnerRouteConfig?((e,o)=>{var a;const i=Boolean(o.tpaPageUri&&!f().isNil(l.applicationId)&&l.applicationId===o.tpaApplicationId),[s]=((null==r?void 0:r.location.href)||n).replace(t,"").split("?"),[c,u]=decodeURIComponent(s).split("?"),p=i&&(0,N._)(c,o.tpaPageUri);return p&&(null===(a=l.appPage)||void 0===a?void 0:a.defaultPage)&&p.unshift(l.appPage.defaultPage),p?((e,t,n)=>{if(0===e.length)return t;const r=e.join("/"),o=new URL(t);o.pathname+=`/${r}`,n&&new URLSearchParams(n).forEach(((e,t)=>o.searchParams.append(t,e)));return o.href})(p,e,u):e})(c,p.tpaInnerRouteConfig):c;let v;try{v=new URL(m)}catch(e){return""}return f().entries(g).forEach((([e,t])=>{f().isNil(t)||v.searchParams.set(e,t)})),v.href}}))),L=(0,a.ff)([],(()=>{const e={},t={};return{registerTpaSection(n,r){e[n]=r,t[r.appDefinitionId]=n},unregisterTpaSection(n){const r=e[n],o=null==r?void 0:r.appDefinitionId;delete e[n],o&&delete t[o]},getTpaSectionByAppDefinitionId(n){const r=t[n];return e[r]}}}));var Q=n(26725),q=n(27906),J=n(41906);const B=e=>{if(e.data)try{return JSON.parse(e.data)}catch(e){}return{}},W=["getWixUpgradeUrl","stylesReady","getViewModeInternal","setHelpArticle"];var F=n(19378);const H=(0,a.ff)([q.D,Q._w,o.ex,p.QZ,l.jj,(0,a.jt)(F.wk),(0,a.jt)(c.EE),(0,a.jt)(J.KO)],((e,t,n,a,i,s,c,u)=>({appDidMount(){e.addWindowMessageHandler({canHandleEvent(e){return!!(e.source&&(t=B(e),t&&["TPA","TPA2"].includes(t.intent)));var t},async handleEvent(e){var l;const p=B(e),{type:d,callId:f}=p;if(W.includes(d))return;const g=(({compId:e})=>{if(!e)return;const t=n.getTpaComponentPageInfo(e);if(!t||!t.contextId){const t=a.getContextIdOfCompId(e);if(t)return{contextId:t,pageId:t}}return t})(p),m=g&&g.contextId?g.contextId:null,v=n.getTpaComponentIdFromTemplate(p.compId),y=null!=v?v:p.compId,I=Object.assign(Object.assign({},p),{compId:y}),h=e.origin;u&&u.tpa.addMessage({message:I,compId:y,contextId:m,origin:h});const P=null===(l=i.getCurrentRouteInfo())||void 0===l?void 0:l.contextId,C=null==s?void 0:s.getCurrentOrPendingPopupId(),S=await(async(e,n)=>{var o,a,i;if(e)return null===(i=null===(a=null===(o=(await t(e.contextId,e.pageId)).getAllImplementersOnPageOf(r.jn)[0])||void 0===o?void 0:o.getOpenedPopups())||void 0===a?void 0:a[n])||void 0===i?void 0:i.isPersistent;return!1})(g,y);if(!m||"masterPage"!==m&&!S&&m!==P&&m!==C)return void console.error("TPA handler message caller does not belong to any page",{type:d,callId:f,compId:y});const R=await(async({contextId:e,pageId:n})=>(await t(e,n)).getAllImplementersOnPageOf(o.XA)[0])(g);R.handleMessage({source:e.source,origin:h,message:I}).catch((e=>{console.error("HandleTpaMessageError",d,m,y,e),null==c||c.captureError(e,{tags:{feature:"tpa",handlerName:d},extra:{handlerName:d,compId:y}})}))}})}}))),K=(0,a.ff)([p.xP,l.jj],((e,t)=>{const n={};return{cacheProps(t,r){const o=f().omitBy(r||e.get(t),f().isFunction);n[t]=f().isEmpty(o)?null:o},getCachedProps(e){var r,o,a,i;const s=n[e];if(s)return f().isEqual(null===(o=null===(r=t.getCurrentRouteInfo())||void 0===r?void 0:r.dynamicRouteData)||void 0===o?void 0:o.publicData,null===(i=null===(a=t.getPreviousRouterInfo())||void 0===a?void 0:a.dynamicRouteData)||void 0===i?void 0:i.publicData)||delete s.src,s}}})),k=e=>{(e=>{e(o.lP).to(K),e(U.j.AppDidMountHandler).to(H),e(o.ex).to(j),e(o.RN).to(A),e(o.B_).to(L),e(r.RR).to(v),e(r.RR).to(I),e(r.RR).to(h),e(r.RR).to(S),e(r.RR).to(R),e(r.RR).to(w)})(e),e(r.RR).to(C),e(r.RR).to(y),e(r.RR).to(P),e(o.yA).to(_)}},62824:function(e,t,n){"use strict";n.d(t,{_:function(){return r}});const r=(e,t)=>{const n=e.split("/"),r=n.indexOf(t||"");if(r<0||n[r]!==t)return null;const[,...o]=n.splice(r);return o}}}]);
//# sourceMappingURL=https://static.parastorage.com/services/wix-thunderbolt/dist/tpaCommons.62283293.chunk.min.js.map